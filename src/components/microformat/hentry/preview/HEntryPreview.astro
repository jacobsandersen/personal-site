---
import PostDates from "~/components/fragments/PostDates.astro";
import Categories from "~/components/fragments/Categories.astro";
import type Mf2Extractor from "~/lib/extractor/Mf2Extractor";
import ArticlePreview from "./type/ArticlePreview.astro";
import BookmarkPreview from "./type/BookmarkPreview.astro";
import CheckinPreview from "./type/CheckinPreview.astro";
import LikePreview from "./type/LikePreview.astro";
import NotePreview from "./type/NotePreview.astro";
import PhotoPreview from "./type/PhotoPreview.astro";
import ReplyPreview from "./type/ReplyPreview.astro";
import RepostPreview from "./type/RepostPreview.astro";
import RsvpPreview from "./type/RsvpPreview.astro";
import { getPermalinkUrl } from "~/util/mf2-util";

export interface Props {
    extractor: Mf2Extractor;
}

const { extractor } = Astro.props;

const RootElem = extractor.getRootElem();
const content = await extractor.getPost();
const permalink = getPermalinkUrl(extractor.getProperties())
---

<RootElem
    class:list={[
        "h-entry",
        "tw:border-2 tw:border-dashed tw:border-blue-400 tw:dark:border-blue-900 tw:p-4 tw:rounded-sm",
    ]}
>
    <div class:list={["e-content"]}>
        {
            (() => {
                switch (content.type) {
                    case "article":
                        return <ArticlePreview article={content} />;
                    case "checkin":
                        return <CheckinPreview checkin={content} />;
                    case "like":
                        return <LikePreview like={content} />;
                    case "note":
                        return <NotePreview note={content} />;
                    case "repost":
                        return <RepostPreview repost={content} />;
                    case "rsvp":
                        return <RsvpPreview rsvp={content} />;
                    case "photo":
                        return <PhotoPreview photo={content} />;
                    case "reply":
                        return <ReplyPreview reply={content} />;
                    case "bookmark":
                        return <BookmarkPreview bookmark={content} />;
                }
            })()
        }
    </div>
    <a href={permalink} class="tw:text-sm tw:text-gray-500">Go to post</a>
    <div class="tw:flex tw:justify-between">
        <Categories categories={extractor.getCategories()} />
        <PostDates extractedDates={extractor.getDates()} />
    </div>
</RootElem>
