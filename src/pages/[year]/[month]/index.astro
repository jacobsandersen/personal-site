---
import PostListRenderer from "~/components/post/PostListRenderer.astro";
import PageLayout from "~/layouts/PageLayout.astro";
import { QueryParams, queryPosts } from "~/lib/scribble/scribble";
import { parseAdhoc } from "~/util/dates";
import { validateMonthForPath, validateYearForPath } from "~/util/url";

const { year, month } = Astro.params;
if (!validateYearForPath(year) || !validateMonthForPath(month)) {
    return new Response(null, { status: 404 });
}

const queryParams: QueryParams = {
    year: Number(year!),
    month: Number(month!)
}

const date = new Date()
date.setFullYear(queryParams.year!)
date.setMonth((queryParams.month ?? 1) - 1)
date.setDate(1)

const formattedDate = parseAdhoc(date, 'MMMM, YYYY')

const results = await queryPosts(queryParams);
const title = `Posts from ${formattedDate}`;
---

<PageLayout title={title}>
    <h1>{title}</h1>
    <PostListRenderer posts={results} />
</PageLayout>
