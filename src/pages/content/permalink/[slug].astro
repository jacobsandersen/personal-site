---
import { getCollection } from "astro:content";
import type { Mf2Document } from "../../../types/mf2-document";

export async function getStaticPaths() {
    const content = await getCollection("scribble")
    return content.map(doc => {
        return {
            params: {
                slug: doc.data.properties['slug'][0]
            },
            props: {
                ...doc.data
            }
        }
    })
}

const doc = Astro.props as Mf2Document

const title = doc.properties.name?.[0] ?? "no title"
const content = doc.properties.content ?? []
const otherProperties = Object.entries(doc.properties).filter(
  ([key]) => key !== 'name' && key !== 'content'
)

const renderValue = (value: unknown): any => {
  if (Array.isArray(value)) {
    return (
      <ul style="margin: 0 0 0 1em; padding: 0;">
        {value.map((v, i) => (
          <li style="list-style: disc inside;">{renderValue(v)}</li>
        ))}
      </ul>
    )
  }
  if (typeof value === 'object' && value !== null) {
    return (
      <ul style="margin: 0 0 0 1em; padding: 0;">
        {Object.entries(value).map(([k, v]) => (
          <li style="list-style: circle inside;">
            <strong>{k}:</strong> {renderValue(v)}
          </li>
        ))}
      </ul>
    )
  }
  return <span>{String(value)}</span>
}
---

<h1>{title}</h1>

{otherProperties.length > 0 && (
  <div>
    {otherProperties.map(([key, value]) => (
      <div style="margin-bottom: 0.5em;">
        <strong>{key}:</strong> {renderValue(value)}
      </div>
    ))}
  </div>
)}

{content.map((item) => {
  if (typeof item === 'string') {
    return <p>{item}</p>
  }
  if (typeof item === 'object' && item !== null && 'html' in item) {
    return <div set:html={item.html} />
  }
})}