---
import HFeedRenderer from "~/components/microformat/hfeed/HFeedRenderer.astro";
import BaseLayout from "~/layouts/BaseLayout.astro";
import { QueryParams, queryPosts } from "~/lib/scribble/scribble";
import { parseAdhoc } from "~/util/dates";
import { validateMonthForPath, validateYearForPath } from "~/util/url";

const { year, month } = Astro.params;
if (!validateYearForPath(year) || !validateMonthForPath(month)) {
    return new Response(null, { status: 404 });
}

const queryParams: QueryParams = {
    type: "h-entry",
    year: Number(year!),
    month: Number(month!),
};

const date = new Date();
date.setFullYear(queryParams.year!);
date.setMonth((queryParams.month ?? 1) - 1);
date.setDate(1);

const formattedDate = parseAdhoc(date, "MMMM, YYYY");

const results = await queryPosts(queryParams);
const title = `Posts from ${formattedDate}`;
---

<BaseLayout title={title}>
    <HFeedRenderer
        posts={results}
        feedInfo={{ title, url: `/${year}/${month}` }}
    />
</BaseLayout>
