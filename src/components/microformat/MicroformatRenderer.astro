---
import { Mf2Document } from '~/types/mf2-document'
import UnknownFormatRenderer from './UnknownFormatRenderer.astro'
import HEntryRenderer from './hentry/HEntryRenderer.astro'

export interface Props {
  doc: Mf2Document
  preview?: boolean
  typePredicate?: (type: string) => boolean
}

const { doc, preview = false, typePredicate } = Astro.props
const type = doc['type'] ? (doc['type'][0] as string) : 'unknown'

let Renderer: typeof HEntryRenderer | 
              typeof UnknownFormatRenderer

if (type === 'h-entry') {
  Renderer = HEntryRenderer
} else {
  Renderer = UnknownFormatRenderer
}

const shouldNoOp = typePredicate ? !typePredicate(type) : false
---

{shouldNoOp ? <></> : <Renderer props={doc.properties} preview={preview} />}

<!-- <pre class="text-xs mt-2">{JSON.stringify(doc, null, 2)}</pre> -->