---
import { getCollection } from "astro:content";
import type { Mf2Document } from "../../../types/mf2-document";

export async function getStaticPaths() {
    const content = await getCollection("scribble")
    return content.map(doc => {
        return {
            params: {
                slug: doc.data.properties['slug'][0]
            },
            props: {
                ...doc.data
            }
        }
    })
}

const doc = Astro.props as Mf2Document

const title = doc.properties.name?.[0] ?? "no title"
const content = doc.properties.content ?? []
const otherProperties = Object.entries(doc.properties).filter(
  ([key]) => key !== 'name' && key !== 'content'
)
---

<h1>{title}</h1>

{otherProperties.length > 0 && (
  <div>
    {otherProperties.map(([key, value]) => (
      <p>
        <strong>{key}:</strong>{' '}
        {Array.isArray(value) ? value.join(', ') : value}
      </p>
    ))}
  </div>
)}

{content.map((item) => {
  if (typeof item === 'string') {
    return <p>{item}</p>
  }
  if (typeof item === 'object' && item !== null && 'html' in item) {
    return <div set:html={item.html} />
  }
})}